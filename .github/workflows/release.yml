name: Create Release Package

on:
  push:
    tags:
      - 'v*.*.*'  # Triggers on version tags like v1.0.0, v1.2.3, etc.

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Get version from tag
        id: get_version
        run: echo "VERSION=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT
      
      - name: Create release package
        run: |
          mkdir -p release
          cp .gitignore release/
          cp commit-changes-windows.bat release/
          cp commit-changes-linux-mac.sh release/
          cp commit-changes.py release/
          
          # Create simplified README for end users
          cat > release/README.md << 'EOF'
          # Ignition Git Version Control
          
          **Simple version control for your Ignition projects**
          
          ## Quick Setup
          
          1. **Copy these files** to your Ignition root folder:
             - `.gitignore`
             - One script file (`.bat` for Windows, `.sh` for Linux/Mac, or `.py` for Python)
          
          2. **Open terminal** in Ignition folder and run:
             ```bash
             git init
             git config user.name "Your Name"
             git config user.email "your.email@example.com"
             git add .
             git commit -m "Initial Ignition setup"
             ```
          
          3. **Test it:**
             - Windows: `commit-changes-windows.bat "Test"`
             - Linux/Mac: `chmod +x commit-changes-linux-mac.sh && ./commit-changes-linux-mac.sh "Test"`
             - Python: `python commit-changes.py "Test"`
          
          ## Auto-Save from Ignition
          
          Gateway → Config → System → Events → Add Project Published Event:
          
          ```python
          import system
          projectName = projectPublishedEvent.getProjectName()
          userName = projectPublishedEvent.getActorName()
          message = "Published: %s (by %s)" % (projectName, userName)
          system.util.execute(["commit-changes-windows.bat", message])  # Change to your script
          ```
          
          ## What Gets Tracked
          
          ✅ Projects, Gateway config, Settings  
          ❌ Databases, Backups, Logs, Certificates
          
          ## Need Help?
          
          - Check log: `data/git-commits.log`
          - View history: `git log --oneline`
          - Full documentation: https://github.com/TahriTech/Ignition-3-Step-Git
          EOF
          
          cd release
          zip -r ../ignition-git-${{ steps.get_version.outputs.VERSION }}.zip .
      
      - name: Create GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          files: ignition-git-${{ steps.get_version.outputs.VERSION }}.zip
          body: |
            ## Ignition 3-Step Git Version Control ${{ steps.get_version.outputs.VERSION }}
            
            ### What's Included:
            - `.gitignore` - Tells Git what to track and ignore
            - `commit-changes-windows.bat` - Windows version
            - `commit-changes-linux-mac.sh` - Linux/Mac version  
            - `commit-changes.py` - Python cross-platform version
            - `README.md` - Quick setup guide
            
            ### Quick Start:
            1. Download and extract the ZIP file
            2. Copy `.gitignore` and one script to your Ignition root folder
            3. Run `git init` and setup commands (see README.md)
            4. Test with your chosen script
            
            ### Full Documentation:
            See the [repository README](https://github.com/TahriTech/Ignition-3-Step-Git) for detailed instructions, troubleshooting, and integration examples.
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
